{% extends "base.html" %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/apontar_horas.css' %}">
{% endblock head %}

{% block body %}
<div class="container">

  <!-- Painel esquerdo: Apontamento -->
  <div class="panel apontamento">
    <h2>Apontar Horas</h2>

    <form method="post" action="{% url 'apontar_horas' %}">
      {% csrf_token %}

      <!-- Matrícula -->
      <div class="form-group">
        <label for="matricula">Matrícula do Colaborador</label>
        <input type="text" id="matricula" name="matricula" placeholder="Ex: 1025" class="input-field" required>
      </div>

      <!-- Nome colaborador -->
      <div class="form-group">
        <label for="nome_colaborador">Nome do Colaborador</label>
        <div class="input-loading">
          <input type="text" id="nome_colaborador" readonly class="input-field">
          <span class="loading-spinner" id="loading-colaborador"></span>
        </div>
      </div>


      <!-- Número da OS -->
      <div class="form-group">
        <label for="numero_os">Número da OS</label>
        <input type="text" id="numero_os" name="numero_os" placeholder="Ex: 230" class="input-field" required>
      </div>

      <!-- Descrição OS -->
      <div class="form-group">
        <label for="descricao_os">Descrição da OS</label>
        <div class="input-loading">
          <textarea id="descricao_os" readonly rows="3" class="input-field"></textarea>
          <span class="loading-spinner" id="loading-os"></span>
        </div>
      </div>


      {% if messages %}
      <div class="messages">
        {% for message in messages %}
        <div class="alert-message
      {% if message.tags == 'error' %} bg-red-500
      {% elif message.tags == 'success' %} bg-green-500
      {% elif message.tags == 'warning' %} bg-yellow-500
      {% else %} bg-blue-500
      {% endif %}
      px-4 py-3 rounded-lg text-white font-medium shadow mb-2
    ">
          {{ message }}
        </div>
        {% endfor %}
      </div>
      {% endif %}


      <!-- Botões -->
      <div class="form-actions">
        <button type="submit" name="acao" value="iniciar" class="save-btn">▶️ Iniciar OS</button>
        <button type="submit" name="acao" value="finalizar" class="delete-btn">⏹️ Finalizar OS</button>
      </div>
    </form>
  </div>

  <!-- Painel direito: Lista de OS -->
  <div class="panel tabela-os">
    <h2>Ordens de Serviço</h2>

    <!-- Filtro -->
    <div class="filtro-container">
      <input type="text" id="filtro" class="input-field"
        placeholder="Filtrar por Nº OS, descrição, centro de custo ou cliente...">
    </div>

    <div class="os-table-container">
      {% if ordens %}
      <table class="os-table">
        <thead>
          <tr>
            <th>Nº OS</th>
            <th>Descrição</th>
            <th>Centro de Custo</th>
            <th>Cliente</th>
            <th>Situação</th>
          </tr>
        </thead>
        <tbody id="lista-os">
          {% for o in ordens %}
          <tr>
            <td>{{ o.numero_os }}</td>
            <td>{{ o.descricao_os }}</td>
            <td>{{ o.centro_custo.descricao }}</td>
            <td>{{ o.cliente.nome_cliente }}</td>
            <td>
              <span class="
    px-2 py-1 rounded text-sm font-semibold
    {% if o.situacao == 'FI' %} bg-red-100 text-red-700
    {% elif o.situacao == 'AB' %} bg-green-100 text-green-700
    {% endif %}
  ">
                {{ o.get_situacao_display }}
              </span>
            </td>

          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>Nenhuma OS encontrada.</p>
      {% endif %}
    </div>
  </div>
</div>

<script src="{% static 'js/apontamento_horas.js' %}"></script>

{% endblock %}