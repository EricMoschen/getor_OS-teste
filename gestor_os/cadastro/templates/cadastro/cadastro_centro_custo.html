{% extends "base.html" %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/form_centro_custo.css' %}">
{% endblock head %}

{% block body %}
<div class="container">

    <!-- Painel esquerdo: Formulário -->
    <div class="left-panel">
        <h2 class="text-xl font-bold mb-4">Cadastrar Centro de Custo</h2>
        <form action="{% url 'cadastrar_centro_custo' %}" method="POST">
            {% csrf_token %}
            <div class="mb-3">
                <label class="block mb-1">Código do Centro de Custo</label>
                {{ form.cod_centro }}
            </div>
            <div class="mb-3">
                <label class="block mb-1">Descrição do Centro de Custo</label>
                {{ form.descricao }}
            </div>
            <div class="mb-3">
                <label class="block mb-1">Centro Pai (opcional)</label>
                {{ form.centro_pai }}
            </div>
            <button type="submit" class="bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded text-white font-semibold">Cadastrar</button>
        </form>

        {% if messages %}
        <div class="mt-4 p-2 bg-green-600/20 border border-green-500 rounded text-green-200">
            {% for message in messages %}
                <div>{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <!-- Painel direito: Lista hierárquica -->
    <div class="right-panel">
        <h2 class="text-xl font-bold mb-4">Centros de Custo Cadastrados</h2>

        {% for item in hierarquia %}
            <ul class="tree">
                <li>
                    {% if item.filhos %}
                        <span class="tree-toggle font-bold">{{ item.centro.descricao }} - {{ item.centro.cod_centro }}</span>
                        <ul class="nested">
                            {% include 'cadastro/subcentros.html' with subcentros=item.filhos %}
                        </ul>
                    {% else %}
                        {{ item.centro.descricao }} - {{ item.centro.cod_centro }}
                    {% endif %}
                </li>
            </ul>
        {% endfor %}
    </div>

</div>

<!-- Script da árvore colapsável -->
<script src="{% static 'js/tree_toggle.js' %}"></script>

{% endblock %}
